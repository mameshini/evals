kind: AdaptiveDialog
modelDescription: This topic will handle queries to look up details about a specific service request.
beginDialog:
  kind: OnRecognizedIntent
  id: main
  intent:
    triggerQueries:
      - Find my request
      - Check request status
      - Lookup ticket
      - Who is my ticket assigned to
      - Check on a request
      - What is the status
      - Lookup a request

  actions:
    - kind: Question
      id: question_RmS8cJ
      interruptionPolicy:
        allowInterruption: true
        interruptionTopicListFilter:
          kind: IncludeSelectedTopics
          allowedInterruptTopics:
            - cr3fb_itHelpdeskV1.topic.CreateRequest
            - cr3fb_itHelpdeskV1.topic.Escalate
            - cr3fb_itHelpdeskV1.topic.Goodbye
            - cr3fb_itHelpdeskV1.topic.Greeting
            - cr3fb_itHelpdeskV1.topic.WhatCanIAsk
            - cr3fb_itHelpdeskV1.topic.LookupRequest
            - cr3fb_itHelpdeskV1.topic.StartOver
            - cr3fb_itHelpdeskV1.topic.Thankyou
            - cr3fb_itHelpdeskV1.topic.ViewMyRequests

      unrecognizedPrompt: That does not appear to be a valid service request number format. Can you please try again?
      repeatCount: 1
      alwaysPrompt: false
      variable: init:Topic.SNServiceRequestNumber
      prompt: What is the service request number?
      entity:
        kind: RegexEntityReference
        entityId: cr3fb_itHelpdeskV1.customtype.SNSRNumber

    - kind: BeginDialog
      id: XuyspE
      dialog: cr3fb_itHelpdeskV1.topic.GetCaller

    - kind: ConditionGroup
      id: Cueekw
      conditions:
        - id: ML3X6z
          condition: =IsBlank(Global.SNCallerId)
          actions:
            - kind: GotoAction
              id: 5MgfyZ
              actionId: sendActivity_cQKpwB

    - kind: InvokeConnectorAction
      id: invokeConnectorAction_4OE66R
      input:
        binding:
          sysparm_display_value: true
          sysparm_exclude_reference_link: true
          sysparm_limit: 1
          sysparm_query: =Concatenate("number=",Topic.SNServiceRequestNumber,"^","caller_id=",Global.SNCallerId)
          tableType: incident

      output:
        binding:
          result: Topic.RequestResults

      connectionReference: cr3fb_itHelpdeskV1.connectionreference.cr51e_itHelpDeskCopilot.cr.wC4Tw1wa
      connectionProperties:
        mode: Maker

      dynamicOutputSchema:
        kind: Record
        properties:
          result:
            order: 0
            type:
              kind: Table
              properties:
                action_status:
                  displayName: Action status
                  order: 110
                  type: String

                actions_taken:
                  displayName: Actions taken
                  description: Updates posted on major incident
                  order: 75
                  type: String

                active:
                  displayName: Active
                  order: 24
                  type: String

                activity_due:
                  displayName: Activity due
                  description: Date by which the Inactivity Monitor expects the task to be updated
                  order: 109
                  type: String

                additional_assignee_list:
                  displayName: Additional assignee list
                  description: Additional assignees
                  order: 40
                  type: String

                approval:
                  displayName: Approval
                  order: 114
                  type: String

                approval_history:
                  displayName: Approval history
                  order: 9
                  type: String

                approval_set:
                  displayName: Approval set
                  order: 30
                  type: String

                assigned_to:
                  displayName: Assigned to
                  description: Person primarily responsible for working this task
                  order: 50
                  type: String

                assignment_group:
                  displayName: Assignment group
                  order: 93
                  type: String

                business_duration:
                  displayName: Business duration
                  description: Business time elapsed before task was closed
                  order: 27
                  type: String

                business_impact:
                  displayName: Business impact
                  order: 81
                  type: String

                business_service:
                  displayName: Business service
                  order: 80
                  type: String

                business_stc:
                  displayName: Business resolve time
                  description: Business time elapsed (stored in seconds) before Incident was resolved
                  order: 94
                  type: String

                calendar_duration:
                  displayName: Duration
                  description: Time elapsed before task was closed
                  order: 99
                  type: String

                calendar_stc:
                  displayName: Resolve time
                  description: Time elapsed (stored in seconds) before Incident was Resolved
                  order: 77
                  type: String

                caller_id:
                  displayName: Caller
                  description: Person who reported or is affected by this incident
                  order: 87
                  type: String

                category:
                  displayName: Category
                  order: 121
                  type: String

                cause:
                  displayName: Probable cause
                  order: 95
                  type: String

                caused_by:
                  displayName: Caused by Change
                  description: Change request that caused the incident
                  order: 3
                  type: String

                child_incidents:
                  displayName: Child Incidents
                  description: Number of child Incidents related to this Problem
                  order: 65
                  type: String

                close_code:
                  displayName: Close code
                  description: For use in reporting
                  order: 92
                  type: String

                close_notes:
                  displayName: Close notes
                  order: 100
                  type: String

                closed_at:
                  displayName: Closed
                  order: 78
                  type: String

                closed_by:
                  displayName: Closed by
                  order: 44
                  type: String

                cmdb_ci:
                  displayName: Configuration item
                  description: Item or service affected
                  order: 20
                  type: String

                comments:
                  displayName: Additional comments
                  description: Journaled field, shared with the end user
                  order: 113
                  type: String

                comments_and_work_notes:
                  displayName: Comments and Work notes
                  description: Combined output of Additional comments and Work notes
                  order: 53
                  type: String

                company:
                  displayName: Company
                  order: 107
                  type: String

                contact_type:
                  displayName: Channel
                  order: 102
                  type: String

                contract:
                  displayName: Contract
                  order: 22
                  type: String

                correlation_display:
                  displayName: Correlation display
                  order: 35
                  type: String

                correlation_id:
                  displayName: Correlation ID
                  order: 57
                  type: String

                delivery_plan:
                  displayName: Delivery plan
                  order: 21
                  type: String

                delivery_task:
                  displayName: Delivery task
                  order: 36
                  type: String

                description:
                  displayName: Description
                  description: What change steps will be performed?
                  order: 96
                  type: String

                due_date:
                  displayName: Due date
                  description: Expected date from assigned to
                  order: 115
                  type: String

                escalation:
                  displayName: Escalation
                  order: 55
                  type: String

                expected_start:
                  displayName: Expected start
                  order: 84
                  type: String

                follow_up:
                  displayName: Follow up
                  order: 45
                  type: String

                group_list:
                  displayName: Group list
                  description: Interested groups
                  order: 28
                  type: String

                impact:
                  displayName: Impact
                  description: Measure of the business criticality of the affected service
                  order: 23
                  type: String

                incident_state:
                  displayName: Incident state
                  description: Workflow state of the incident
                  order: 104
                  type: String

                knowledge:
                  displayName: Knowledge
                  description: If checked, will automatically create a Draft knowledge article upon closure
                  order: 18
                  type: String

                lessons_learned:
                  displayName: Findings
                  order: 15
                  type: String

                location:
                  displayName: Location
                  description: Where the caller or service is located
                  order: 120
                  type: String

                made_sla:
                  displayName: Made SLA
                  order: 60
                  type: String

                major_incident_state:
                  displayName: Major incident state
                  order: 31
                  type: String

                needs_attention:
                  displayName: Needs attention
                  description: If checked, the agent needs to review this task.
                  order: 32
                  type: String

                notify:
                  displayName: Notify
                  order: 41
                  type: String

                number:
                  displayName: Number
                  order: 12
                  type: String

                opened_at:
                  displayName: Opened
                  order: 85
                  type: String

                opened_by:
                  displayName: Opened by
                  order: 70
                  type: String

                order:
                  displayName: Order
                  order: 19
                  type: String

                origin_id:
                  displayName: Origin
                  order: 98
                  type: String

                origin_table:
                  displayName: Origin table
                  description: Table of the Origin record
                  order: 8
                  type: String

                overview:
                  displayName: Overview
                  order: 112
                  type: String

                parent:
                  displayName: Parent
                  order: 1
                  type: String

                parent_incident:
                  displayName: Parent Incident
                  description: Can be used to collect Incidents for the same root issue
                  order: 46
                  type: String

                priority:
                  displayName: Priority
                  description: Sequence in which an Incident or Problem needs to be resolved, based on impact and urgency
                  order: 26
                  type: String

                problem_id:
                  displayName: Problem
                  description: Related problem, if one exists
                  order: 106
                  type: String

                promoted_by:
                  displayName: Promoted by
                  description: One who manually promotes to major incident
                  order: 0
                  type: String

                promoted_on:
                  displayName: Promoted on
                  description: Date and time of when this incident was promoted as major incident
                  order: 61
                  type: String

                proposed_by:
                  displayName: Proposed by
                  description: The user who proposed the incident as a major incident candidate
                  order: 13
                  type: String

                proposed_on:
                  displayName: Proposed
                  description: Date and time when the incident was proposed as a major incident candidate
                  order: 74
                  type: String

                reassignment_count:
                  displayName: Reassignment count
                  order: 49
                  type: String

                reopen_count:
                  displayName: Reopen count
                  description: Number of times Incident state has changed from Resolved or Closed to another state
                  order: 117
                  type: String

                reopened_by:
                  displayName: Last reopened by
                  order: 47
                  type: String

                reopened_time:
                  displayName: Last reopened at
                  order: 88
                  type: String

                resolved_at:
                  displayName: Resolved
                  order: 89
                  type: String

                resolved_by:
                  displayName: Resolved by
                  order: 67
                  type: String

                rfc:
                  displayName: Change Request
                  description: Related change, if one exists
                  order: 82
                  type: String

                route_reason:
                  displayName: Route reason
                  order: 76
                  type: String

                service_offering:
                  displayName: Service offering
                  order: 42
                  type: String

                severity:
                  displayName: Severity
                  order: 111
                  type: String

                short_description:
                  displayName: Short description
                  order: 34
                  type: String

                skills:
                  displayName: Skills
                  description: Required skills
                  order: 10
                  type: String

                sla_due:
                  displayName: SLA due
                  description: Date by which the SLA expects this task to be completed
                  order: 51
                  type: String

                sn_esign_document:
                  displayName: E-signature document
                  description: E-Signature document
                  order: 64
                  type: String

                sn_esign_esignature_configuration:
                  displayName: E-signature template
                  description: E-Signature configuration
                  order: 103
                  type: String

                state:
                  displayName: State
                  order: 16
                  type: String

                subcategory:
                  displayName: Subcategory
                  order: 90
                  type: String

                sys_class_name:
                  displayName: Task type
                  order: 43
                  type: String

                sys_created_by:
                  displayName: Created by
                  order: 17
                  type: String

                sys_created_on:
                  displayName: Created
                  order: 72
                  type: String

                sys_domain:
                  displayName: Domain
                  description: Domain to which the task belongs
                  order: 73
                  type: String

                sys_id:
                  displayName: Sys ID
                  order: 101
                  type: String

                sys_mod_count:
                  displayName: Updates
                  order: 116
                  type: String

                sys_tags:
                  displayName: Tags
                  order: 118
                  type: String

                sys_updated_by:
                  displayName: Updated by
                  order: 69
                  type: String

                sys_updated_on:
                  displayName: Updated
                  order: 7
                  type: String

                task_effective_number:
                  displayName: Effective number
                  order: 66
                  type: String

                time_worked:
                  displayName: Time worked
                  order: 83
                  type: String

                timeline:
                  displayName: Timeline
                  order: 58
                  type: String

                trigger_rule:
                  displayName: Trigger Rule
                  order: 38
                  type: String

                u_ado:
                  displayName: ADO
                  order: 59
                  type: String

                u_afterhourssupport:
                  displayName: After Hours Support
                  order: 97
                  type: String

                u_awaiting_user_count:
                  displayName: Awaiting User Count
                  order: 108
                  type: String

                u_business_service:
                  displayName: Business service
                  order: 68
                  type: String

                u_fcr:
                  displayName: FCR
                  description: Check this box if this was Resolved on first call
                  order: 14
                  type: String

                u_jira_key:
                  displayName: Jira Key
                  order: 54
                  type: String

                u_major_incident:
                  displayName: Major Incident
                  order: 62
                  type: String

                u_other_ci:
                  displayName: Other CI
                  order: 48
                  type: String

                u_other_ci_notes:
                  displayName: Other CI Notes
                  order: 2
                  type: String

                u_proficio_needs_update:
                  displayName: Proficio Needs Update
                  order: 39
                  type: String

                u_proficio_remote_last_updated:
                  displayName: Proficio Remote Last Updated
                  order: 11
                  type: String

                u_proficio_remote_number:
                  displayName: Proficio Remote Number
                  order: 79
                  type: String

                u_proficio_remote_state:
                  displayName: Proficio Remote State
                  order: 4
                  type: String

                u_resolution_time:
                  displayName: Resolution Time(Minutes)
                  description: Time taken to resolve the Incident in minutes
                  order: 63
                  type: String

                u_rework:
                  displayName: Rework
                  order: 52
                  type: String

                u_sent:
                  displayName: Sent
                  order: 29
                  type: String

                u_work_item:
                  displayName: Work Item
                  order: 119
                  type: String

                universal_request:
                  displayName: Universal Request
                  order: 33
                  type: String

                upon_approval:
                  displayName: Upon approval
                  order: 56
                  type: String

                upon_reject:
                  displayName: Upon reject
                  order: 6
                  type: String

                urgency:
                  displayName: Urgency
                  description: Measure of the business criticality based on the impact and on the business needs of the Customer
                  order: 105
                  type: String

                user_input:
                  displayName: User input
                  order: 71
                  type: String

                watch_list:
                  displayName: Watch list
                  description: Interested users
                  order: 5
                  type: String

                work_end:
                  displayName: Actual end
                  order: 86
                  type: String

                work_notes:
                  displayName: Work notes
                  order: 91
                  type: String

                work_notes_list:
                  displayName: Work notes list
                  description: Users interested in work notes
                  order: 25
                  type: String

                work_start:
                  displayName: Actual start
                  order: 37
                  type: String

      operationId: GetRecords

    - kind: ConditionGroup
      id: conditionGroup_YSxvRw
      conditions:
        - id: conditionItem_ncpqXZ
          condition: =IsEmpty(Topic.RequestResults)
          actions:
            - kind: SendActivity
              id: sendActivity_cQKpwB
              activity:
                text:
                  - I could not find a service request with that number for you. Please try again or choose to view all your service requests.
                quickReplies:
                  - kind: MessageBack
                    text: View my requests

      elseActions:
        - kind: ParseValue
          id: dVLoF3
          variable: Topic.ServiceRequest
          valueType:
            kind: Table
            properties:
              active: String
              activity_due: String
              additional_assignee_list: String
              approval: String
              approval_history: String
              approval_set: String
              assigned_to: String
              assignment_group: String
              business_duration: String
              business_impact: String
              business_service: String
              business_stc: String
              calendar_duration: String
              calendar_stc: String
              caller_id: String
              category: String
              cause: String
              caused_by: String
              child_incidents: String
              close_code: String
              close_notes: String
              closed_at: String
              closed_by: String
              cmdb_ci: String
              comments: String
              comments_and_work_notes: String
              company: String
              contact_type: String
              contract: String
              correlation_display: String
              correlation_id: String
              delivery_plan: String
              delivery_task: String
              description: String
              due_date: String
              escalation: String
              expected_start: String
              follow_up: String
              group_list: String
              hold_reason: String
              impact: String
              incident_state: String
              knowledge: String
              location: String
              made_sla: String
              notify: String
              number: String
              opened_at: String
              opened_by: String
              order: String
              origin_id: String
              origin_table: String
              parent: String
              parent_incident: String
              priority: String
              problem_id: String
              reassignment_count: String
              reopen_count: String
              reopened_by: String
              reopened_time: String
              resolved_at: String
              resolved_by: String
              rfc: String
              route_reason: String
              service_offering: String
              severity: String
              short_description: String
              sla_due: String
              state: String
              subcategory: String
              sys_class_name: String
              sys_created_by: String
              sys_created_on: String
              sys_domain: String
              sys_domain_path: String
              sys_id: String
              sys_mod_count: String
              sys_tags: String
              sys_updated_by: String
              sys_updated_on: String
              task_effective_number: String
              time_worked: String
              universal_request: String
              upon_approval: String
              upon_reject: String
              urgency: String
              user_input: String
              watch_list: String
              work_end: String
              work_notes: String
              work_notes_list: String
              work_start: String

          value: "=\"[]\""

        - kind: SetVariable
          id: setVariable_nF9PbU
          variable: Topic.ServiceRequest
          value: =Topic.RequestResults

        - kind: SendActivity
          id: sendActivity_l35Wns
          activity: |-
            Here is what I found.
            
            {Concatenate(
                        "Request Number: ", First(Topic.ServiceRequest).number, Char(13), 
                        "- ", "State: ", First(Topic.ServiceRequest).state, Char(13),
                        "- ", "Assigned To: ", First(Topic.ServiceRequest).assigned_to, Char(13), 
                        "- ", "Title: ", First(Topic.ServiceRequest).short_description, Char(13), 
                        "- ", "Description: ", First(Topic.ServiceRequest).description, Char(13), 
                        "- ", "Opened On: ", DateValue(First(Topic.ServiceRequest).opened_at), Char(13),Char(13)
                    )
            }